#!/bin/sh

# ðŸ”’ SECURITY HOOK â€” Commit message validation
# Verifica se a mensagem de commit contÃ©m caminhos locais

COMMIT_MSG_FILE="$1"
COMMIT_MSG=$(cat "$COMMIT_MSG_FILE")

# PadrÃµes de caminhos locais proibidos (mas ignora se for apenas referÃªncia em contexto)
LOCAL_PATH_PATTERNS="/Users/|/Desktop|/Downloads|/Documents|/home/[^/]+/|C:\\\\Users\\\\"

# Verifica se a mensagem contÃ©m caminhos locais
# Mas ignora se for apenas uma referÃªncia em contexto de documentaÃ§Ã£o/exemplo
if echo "$COMMIT_MSG" | grep -qiE "$LOCAL_PATH_PATTERNS"; then
  # Ignora se for apenas uma referÃªncia em lista de exemplos ou documentaÃ§Ã£o
  # (ex: "Bloqueia commits com caminhos /Users/, /Desktop")
  if echo "$COMMIT_MSG" | grep -qiE "(bloqueia|bloquea|detecta|valida|referÃªncia|referencia|exemplo|exemplos|padrÃ£o|padrÃµes|regra|regras|documentaÃ§Ã£o|documentacao|contÃ©m|contem|inclui|lista)"; then
    # Ã‰ apenas uma referÃªncia em contexto, permite
    exit 0
  fi
  
  # Verifica se Ã© um caminho completo que parece ser cÃ³digo real
  # (ex: "/Users/joao/Desktop/file.png" vs "/Users/, /Desktop")
  if echo "$COMMIT_MSG" | grep -qiE "(/Users/[^/,\s]+/|/Desktop/[^,\s]+|/Downloads/[^,\s]+)"; then
    echo ""
    echo "ðŸ”’ ERRO: Mensagem de commit contÃ©m caminhos locais!"
    echo ""
    echo "A mensagem de commit nÃ£o pode conter caminhos completos de arquivos locais."
    echo "Remova referÃªncias a caminhos como /Users/username/..., /Desktop/file, etc."
    echo ""
    exit 1
  fi
fi

exit 0

